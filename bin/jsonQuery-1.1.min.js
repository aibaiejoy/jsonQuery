function JsonQuery(a){this.data_=a}JsonQuery.queries={"$lt":function(b,a){return b<a},"$lte":function(b,a){return b<=a},"$eq":function(b,a){return b===a},"$ne":function(b,a){return b!==a},"$gt":function(b,a){return b>a},"$gte":function(b,a){return b>=a},"$range":function(b,a){return(b>=a.min&&b<=a.max)},"$xrange":function(b,a){return(b>a.min&&b<a.max)},"$in":function(b,a){return(b in a)},"$nin":function(b,a){return !(b in a)},"$match":function(b,a){if(typeof(b)==="string"){return b.match(a)!==null}return false}};JsonQuery.prototype.where=function(b){var a=[];this.sanitizeQuery_(b);if(!(JsonQuery.isEmpty(b))){var c;for(c in this.data_){if(this.check_(c,b)){a.push(this.data_[c])}}}else{a=a.concat(this.data_)}return a};JsonQuery.prototype.insert=function(a){if(a instanceof Array){this.data_=this.data_.concat(a)}else{this.data_.push(a)}};JsonQuery.prototype.all=function(){return this.where({})};JsonQuery.prototype.mapreduce=function(d,f,c){var e;if(typeof(c)!=="undefined"){e=this.where(c)}else{e=this.data_}var a=[];var b;for(b in e){a.push(d(e[b]))}return f(a)};JsonQuery.prototype.sanitizeQuery_=function(c){var b;for(b in c){if(typeof(c[b])==="object"){var a;for(a in c[b]){if(typeof(JsonQuery.queries[a])==="undefined"){delete c[b][a];continue}if(a==="$in"||a==="$nin"){if(c[b][a] instanceof Array){c[b][a]=JsonQuery.set(c[b][a])}else{delete c[b][a];continue}}else{if(a==="$range"||a==="$xrange"){if(typeof(c[b][a].min)==="undefined"||typeof(c[b][a]).max==="undefined"){delete c[b][a];continue}}else{if(a==="$match"){if(!(c[b][a] instanceof RegExp)){delete c[b][a];continue}}}}}}}};JsonQuery.prototype.check_=function(a,c){var b;for(b in c){if(!this.test_(a,b,c[b])){return false}}return true};JsonQuery.prototype.test_=function(a,b,c){if(typeof(this.data_[a][b])!=="undefined"){if(typeof(c)==="object"){return this.or_(this.data_[a][b],c)}else{return this.data_[a][b]===c}}else{return false}};JsonQuery.prototype.or_=function(b,c){var a;for(a in c){if(this.handle_(b,a,c[a])){return true}}return false};JsonQuery.prototype.handle_=function(b,a,c){if(typeof(JsonQuery.queries[a])!=="undefined"){return JsonQuery.queries[a](b,c)}return false};JsonQuery.set=function(b){var a={};if(b instanceof Array){var c;for(c in b){a[b[c]]=true}}return a};JsonQuery.isEmpty=function(b){var a;for(a in b){return false}return true};