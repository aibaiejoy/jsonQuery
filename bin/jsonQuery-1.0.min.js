JsonQuery.queries={"$lt":function(a,b){return a<b},"$lte":function(a,b){return a<=b},"$eq":function(a,b){return a===b},"$ne":function(a,b){return a!=b},"$gt":function(a,b){return a>b},"$gte":function(a,b){return a>=b},"$range":function(a,b){return(a>=b.min&&a<=b.max)},"$xrange":function(a,b){return(a>b.min&&a<b.max)},"$in":function(a,b){return(a in b)},"$nin":function(a,b){return!(a in b)},"$match":function(a,b){if(typeof(a)==="string"){return a.match(b)!=null}return false}}function JsonQuery(a){this.data_=a}JsonQuery.prototype.where=function(a){var b=[];this.sanitizeQuery_(a);for(row in this.data_){if(this.check_(row,a)){b.push(this.data_[row])}}return b}JsonQuery.prototype.insert=function(a){this.data_.push(a)}JsonQuery.prototype.concat=function(a){this.data_=this.data_.concat(a)}JsonQuery.prototype.all=function(){return this.data_}JsonQuery.prototype.sanitizeQuery_=function(a){for(field in a){if(typeof(a[field])==="object"){for(i in a[field]){if(typeof(JsonQuery.queries[i])==="undefined"){delete a[field][i];continue}if(i==="$in"||i==="$nin"){if(a[field][i]instanceof Array){a[field][i]=JsonQuery.set(a[field][i])}else{delete a[field][i];continue}}else if(i==="$range"||i==="$xrange"){if(typeof(a[field][i].min)==="undefined"||typeof(a[field][i]).max==="undefined"){delete a[field][i];continue}}else if(i==="$match"){if(!(a[field][i]instanceof RegExp)){delete a[field][i];continue}}}}}}JsonQuery.prototype.check_=function(a,b){for(field in b){if(!this.test_(a,field,b[field])){return false}}return true}JsonQuery.prototype.test_=function(a,b,c){if(typeof(this.data_[a][b])!=="undefined"){if(typeof(c)==="object"){return this.or_(this.data_[a][b],c)}else{return this.data_[a][b]===c}}else{return false}}JsonQuery.prototype.or_=function(a,b){for(func in b){if(this.handle_(a,func,b[func])){return true}}return false}JsonQuery.prototype.handle_=function(a,b,c){if(typeof(JsonQuery.queries[b])!=="undefined"){return JsonQuery.queries[b](a,c)}return false}JsonQuery.set=function(a){var b={};if(a instanceof Array){for(i in a){b[a[i]]=true}}return b}
